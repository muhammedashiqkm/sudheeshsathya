<!-- blog_detail.html -->
{% extends "base.html" %}
{% load static %}
{% load query_utils %}

{% block title %}{{ post.title }} - Sudeesh Sathya{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/blog.css' %}">
{% endblock %}

{% block content %}
<section class="blog-detail-section">
    <div class="container">
        <div class="blog-post">
            <div class="post-header">
                <div class="post-category">{{ post.category.name }}</div>
                <h1 class="post-title">{{ post.title }}</h1>
                <div class="post-meta">
                    <span class="post-date">{{ post.published_date|date:"F j, Y" }}</span>
                    <span class="post-author">by Sudeesh Sathya</span>
                </div>
            </div>

            {% if post.image %}
            <div class="post-featured-image">
                <img src="{{ post.image.url }}" alt="{{ post.title }}">
            </div>
            {% endif %}

            <div class="post-content">
                {% for block in post.content_blocks.all %}
                {% if block.block_type == 'heading' %}
                <h2>{{ block.content }}</h2>
                {% elif block.block_type == 'rich_text' %}
                <p>{{ block.content|linebreaks }}</p>
                {% elif block.block_type == 'image' and block.image %}
                <figure class="content-image">
                    <img src="{{ block.image.url }}" alt="{{ block.caption|default:'Content image' }}">
                    {% if block.caption %}
                    <figcaption>{{ block.caption }}</figcaption>
                    {% endif %}
                </figure>
                {% endif %}
                {% endfor %}
            </div>

            <!-- SMART BACK BUTTON: preserve all except scroll_to, then add new -->
            <div class="back-to-blog">
                <a href="{% url 'blog_list' %}?{{ request.META.QUERY_STRING|preserve_query:'scroll_to'|add_query:'scroll_to='|add:post.slug }}"
                   class="btn secondary-btn">
                    Back to Blog
                </a>
            </div>
        </div>
    </div>
</section>
{% endblock %}