{% extends "base.html" %}
{% load static %}

{% block title %}{{ post.title }} - Sudeesh Sathya{% endblock %}

{% block content %}
<section class="blog-detail-section">
    <div class="container">
        <div class="blog-post">
            <div class="post-header">
                <div class="post-category">{{ post.category.name }}</div>
                <h1 class="post-title">{{ post.title }}</h1>
                <div class="post-meta">
                    <span class="post-date">{{ post.created_at|date:"F j, Y" }}</span>
                    <span class="post-author">by Sudeesh Sathya</span>
                </div>
            </div>

            {% if post.image %}
            <div class="post-featured-image">
                <img src="{{ post.image.url }}" alt="{{ post.title }}">
            </div>
            {% endif %}

            <div class="post-content">
                {# UPDATED: Loop through content blocks #}
                {% for block in post.content_blocks.all %}
                {% if block.block_type == 'heading' %}
                <h2>{{ block.content }}</h2>

                {% elif block.block_type == 'rich_text' %}
                <p>{{ block.content|linebreaks }}</p>

                {% elif block.block_type == 'image' and block.image %}
                <figure class="content-image">
                    <img src="{{ block.image.url }}" alt="{{ block.caption|default:'Content image' }}">
                    {% if block.caption %}
                    <figcaption>{{ block.caption }}</figcaption>
                    {% endif %}
                </figure>

                {% elif block.block_type == 'quote' %}
                <blockquote>
                    <p>"{{ block.content }}"</p>
                </blockquote>

                {% endif %}
                {% endfor %}
            </div>

            <div class="post-tags">
                {% for tag in post.tags.all %}
                <span class="post-tag">{{ tag.name }}</span>
                {% endfor %}
            </div>
            <div class="back-to-blog">
                <a href="{% url 'blog_list' %}" class="btn secondary-btn">Back to Blog</a>
            </div>
        </div>
</section>
{% endblock %}